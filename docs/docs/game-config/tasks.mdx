---
sidebar_position: 3
---

import CodeBlock from '@theme/CodeBlock';
import generateResolverOptions from "@site/src/components/shared-lib/generateResolverOptions.tsx";
import JSONSchemaViewer from "@theme/JSONSchemaViewer";
import TaskSchema from "@site/static/schemas/taskSchema.json";
import InlineSchemaDisplay from '@site/src/components/InlineSchemaDisplay';

# Tasks

During the game-based study, participants complete various tasks related to smart home devices. These tasks range from simple actions like turning on devices to complex scenarios where smart home rules intentionally create impossible situations. For example, a task might require making coffee while rules automatically power off the coffee machine, creating an intentionally impossible scenario to study participant behavior.

## JSON Schema

<JSONSchemaViewer schema={ TaskSchema } resolverOptions={generateResolverOptions({"basePath": "/schemas"})} />

<details>
    <summary>JSON Schema Code</summary>

    <InlineSchemaDisplay 
    schema={TaskSchema} 
    resolverOptions={generateResolverOptions({"basePath": "/schemas"})} 
    title="Task Schema"
    />
</details>

## Global Task Configuration

Tasks have four primary global properties that control their presentation, timing, and the optional ability to abort the task: `ordered`, `timer`, `abortable`, and `tasks`.

### Tasks Property: Order

The `ordered` property determines whether tasks appear in a fixed sequence or random order.

```json
{
    "ordered": "true",
    "tasks": [
        { "id": "task_a", "description": "First task" },
        { "id": "task_b", "description": "Second task" },
        { "id": "task_c", "description": "Third task" }
    ]
}
```

#### Order Behavior

- When `ordered: "true"`: Tasks appear in array order (i.e., Task A → Task B → Task C)
- When `ordered: "false"`: Tasks are shuffled (e.g., Task C → Task A → Task B)

:::tip Choosing Task Order
Use ordered tasks when:
- Tasks follow a logical progression
- Later tasks build upon earlier ones
- A specific learning sequence is required

Use random order when:
- Tasks are independent
- You want to minimize learning or carryover effects, which could bias experimental results
- Order doesn't affect task completion
:::

### Tasks Property: Timer

The global timer sets a default time limit for all tasks, which can be overridden by individual task timers.

```json
{
    "timer": 300,  // Global 5-minute timer
    "tasks": [...]
}
```

:::danger Timer Configuration
Even for impossible tasks, appropriate time limits are crucial:
- Give participants enough time to recognize the impossibility
- Allow for different solution attempts
- Prevent excessive frustration
:::

### Tasks Property: Abortable

The global `abortable` flag controls whether tasks should be abortable by default.
Tasks that are abortable can be skipped by participants by clicking on the "X" button on the sidebar. 

TODO: example Figure

Note that this global property can be overwritten for each task individually.

## Individual Task Configuration

Each task in the array defines a specific objective with several key components:

### 1. Core Properties

```json
{
    "id": "make_coffee",
    "description": "Make 5 coffees using the coffee machine",
    "timer": 120,  // Optional override of global timer
    "abortable": false,  // Optional override of global abortable setting
    "abortionOptions": [ // Optional, only effective if abortable = true
        "I believe this task is impossible.",
        "I want to skip this task.",
        "I believe the coffee machine is broken"
    ]
}
```

### 2. Task-Level Abortion Control

Individual tasks can override the global abortion settings:

- **`abortable`**: Boolean that overrides the global abortable setting for this specific task
- **`abortionOptions`**: Array of strings providing predefined reasons for task abortion

```json
{
    "id": "deep_fryer_task",
    "abortable": false,  // This task cannot be aborted even if global setting allows it
    "abortionOptions": [
        "I believe this task is impossible.",
        "I want to skip this task."
    ]
}
```

:::info Abortion Options Usage
The `abortionOptions` property only takes effect if the task's `abortable` property (or global setting) is `true`. When set, participants must choose a reason for aborting their current task upon clicking the "X" button. Otherwise, they can abort the task without providing a reason and proceed to the next available task, if any.
:::

TODO: example Figure

### 3. Environment Variables

Environment variables set the context for tasks and influence rule behavior.
TODO: These variables only exist in the scope of a particular task. (correct?)

```json
{
    "environment": [
        { "name": "Weather", "value": "Sunny" },
        { "name": "Temperature", "value": 20 },
        { "name": "RoomOccupied", "value": true }
    ]
}
```

:::tip Environment Usage
Environment variables can:
- Trigger specific rules
- Create realistic scenarios
- Affect device behavior
:::

### 4. Default Device Properties

These properties reset devices to specific initial states when a task begins.

```json
{
    "defaultDeviceProperties": [
        {
            "device": "coffee_machine",
            "properties": [
                { "name": "Power", "value": false },
                { "name": "Roasting", "value": true }
            ]
        }
    ]
}
```

:::danger Initial States
Consider resetting device properties to their initial states at the commence of a new task:
- Prevent premature rule activation
- Ensure consistent starting conditions
- Set up intended impossible scenarios correctly
:::

### 5. Goals

Goals define the conditions required for task completion. Each task must have at least one goal.
For debugging purposes, it is sufficient to leave out the goal.

A task is successfully completed when all goals of its task are met.

```json
{
    "goals": [
        {
            "device": "coffee_machine",
            "condition": {
                "name": "Number of Coffees Made",
                "operator": ">=",
                "value": 5
            }
        }
    ]
}
```

:::tip Goal Definition
Even for impossible tasks:
- Define clear, measurable objectives
- Use precise operators and values
- Make the goal requirements obvious to participants
:::

## Complete Example

Here's a complete example showing the updated task structure:

```json
{
    "ordered": "true",
    "timer": 120,
    "abortable": true,
    "tasks": [
        {
            "id": "deep_fryer",
            "description": "Turn on the deep fryer",
            "timer": 120,
            "abortable": false,
            "abortionOptions": [
                "I believe this task is impossible.",
                "I want to skip this task."
            ],
            "environment": [
                { "name": "Weather", "value": "Rainy" },
                { "name": "Temperature", "value": 13 }
            ],
            "defaultDeviceProperties": [
                {
                    "device": "deep_fryer",
                    "properties": [
                        { "name": "Power", "value": false }
                    ]
                }
            ],
            "goals": [
                {
                    "device": "deep_fryer",
                    "condition": {
                        "name": "Power",
                        "operator": "==",
                        "value": true
                    }
                }
            ]
        }
    ]
}
```

## Best Practices

1. **Task Description**
   - Write clear, unambiguous instructions
   - If a task is not feasible, do not hint at impossibility
   - Maintain consistent terminology

2. **Timer Management**
   - Set appropriate time limits
   - Consider task complexity
   - Allow for multiple attempt strategies

3. **Abortion Control**
   - Use task-level `abortable` settings to fine-tune which tasks can be skipped
   - Provide meaningful `abortionOptions` to gather useful data about participant reasoning
   - Consider whether allowing abortion might affect your experimental design
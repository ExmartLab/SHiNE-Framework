{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Explanation Engine Configuration",
    "description": "Configuration schema for the explanation engine system",
    "type": "object",
    "properties": {
        "explanation_trigger": {
            "type": "string",
            "enum": [
                "on_demand",
                "automatic"
            ],
            "description": "Defines when explanations are triggered. 'on_demand' shows explanations when user requests via button click. 'automatic' shows explanations immediately when conditions are met."
        },
        "explanation_engine": {
            "type": "string",
            "enum": [
                "integrated",
                "external"
            ],
            "description": "Type of explanation engine to use. 'integrated' for simple rule-based explanations, 'external' for complex custom logic."
        },
        "external_explanation_engine": {
            "type": "object",
            "description": "Configuration for external explanation engine. Contains engine type and API endpoint.",
            "properties": {
                "external_engine_type": {
                    "type": "string",
                    "enum": [
                        "rest",
                        "ws"
                    ],
                    "description": "Communication protocol for external explanation engine. 'rest' for REST API, 'ws' for WebSocket."
                },
                "external_explanation_engine_api": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL of the external explanation engine API endpoint (without trailing slash)."
                }
            },
            "required": ["external_engine_type", "external_explanation_engine_api"],
            "additionalProperties": false
        },
        "integrated_explanation_engine": {
            "type": "object",
            "description": "Collection of explanation rules for the integrated engine. Key is the explanation ID, value is the explanation text (can include HTML).",
            "patternProperties": {
                "^[a-zA-Z0-9_]+$": {
                    "type": "string",
                    "description": "Explanation text that can include HTML tags for formatting"
                }
            },
            "additionalProperties": false
        },
        "explanation_rating": {
            "type": "string",
            "enum": [
                "like"
            ],
            "description": "Enable rating system for explanations. Currently only 'like' (thumbs up/down) is supported."
        },
        "allow_user_message": {
            "type": "boolean",
            "description": "Enable users to send messages to the external explanation engine for interactive explanations.",
            "default": false
        }
    },
    "required": [
        "explanation_trigger",
        "explanation_engine"
    ],
    "allOf": [
        {
            "if": {
                "properties": {
                    "explanation_engine": {
                        "const": "external"
                    }
                }
            },
            "then": {
                "required": [
                    "external_explanation_engine"
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "explanation_engine": {
                        "const": "integrated"
                    }
                }
            },
            "then": {
                "required": [
                    "integrated_explanation_engine"
                ]
            }
        }
    ],
    "additionalProperties": false
}